<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>یلدا</title>

	<link rel="stylesheet" href="static/css/bootstrap-reboot.rtl.min.css">
	<link rel="stylesheet" href="static/css/bootstrap-grid.rtl.min.css">
	<link rel="stylesheet" href="static/css/bootstrap-utilities.rtl.min.css">
	<link rel="stylesheet" href="style.css">
</head>
<body>

	<div class="main">
		<div class="row justify-content-between align-items-center">
			<div class="col-4">
				<div class="logo">
					<img src="static/img/csce.png" alt="انجمن علمی کامپیوتر">
				</div>
			</div>
			<div class="col-4">
				<div class="logo ms-auto">
					<img src="static/img/fum.png" alt="دانشگاه فردوسی">
				</div>
			</div>
		</div>
		<div id="qrcode" class="qrcode">

		</div>

		<h1 class="title">بلیط ورود به جشن یلدا</h1>
		<h2 id="user-name" class="subtitle"></h2>

		<dl class="desc">

			<dt>شماره بلیط</dt>
			<dd id="ticket-id"></dd>

			<dt>تلفن همراه</dt>
			<dd id="phone-number"></dd>

			<!-- <dt>شماره دانشجویی</dt>
			<dd id="student-id"></dd> -->
		</dl>

		<div class="error-msg">
			لینک وارد شده نامعتبر است.
		</div>
	</div>
	
	<script src="static/js/jquery-3.6.0.min.js"></script>
	<script src="static/js/qrcode.min.js"></script>
	<script src="static/js/script.js"></script>

	<script type="text/javascript">

		const BASE_URL = "http://127.0.0.1:8000";

		function get_ticket(ticket_id) {
			return $.get(`${BASE_URL}/ticket/${ticket_id}`).then(res => {
				$("#user-name").html(`${res.first_name} ${res.last_name}`);
				$("#ticket-id").html(`SC-${res.ticket_id}`);
				$("#phone-number").html(res.phone_number);
				return res;
			})
		}

		$(() => {
			var urlParams = new URLSearchParams(window.location.search);
			if(urlParams.has('ticket_id')) {
				const ticket_id = urlParams.get('ticket_id');
				get_ticket(ticket_id).then(res => {
					new QRCode(document.getElementById("qrcode"), `${BASE_URL}/reception/${ticket_id}`);
				}).fail(err => {
					$(".main").addClass('error');
				})
			}
		})
	</script>
</body>
</html>